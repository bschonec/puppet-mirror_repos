<%- |
  String $os,
  Hash $repos_os,
  Optional[Stdlib::HTTPUrl] $proxy,
  Optional[String] $proxy_username,
  Optional[Sensitive[String]] $proxy_password,
| -%>
[main]
cachedir=/var/cache/yum/<%= $os.split(/(\d+)/)[0] %>/<%= $os.split(/(\d+)/)[1] %>
keepcache=0
debuglevel=2
logfile=/var/log/yum.log
exactarch=1
obsoletes=1
gpgcheck=1
plugins=1
<% if $proxy { -%>
proxy=<%= $proxy %>
<% } -%>
<% if $proxy_username { -%>
proxy_username=<%= $proxy_username %>
<% } -%>
<% if $proxy_password { -%>
proxy_password=<%= $proxy_password %>
<% } -%>

<% $repos_os.each |$repo,$info| { -%>
[<%= $repo %>]
name=<%= $os.split("-")[0] %> - <%= $repo %>
<% if 'baseurl' in $info { -%>
baseurl=<%= $info['baseurl'] %>
<% } -%>
<% if 'enabled' in $info { -%>
enabled=<%= $info['enabled'] %>
<% } -%>
<% if 'gpgkey' in $info { -%>
gpgcheck=1
gpgkey=<%= $info['gpgkey'] %>
<% } else { -%>
gpgcheck=0
<% } -%>
<% if 'proxy' in $info { -%>
proxy=<%= $info['proxy'] %>
<% } -%>
<% if 'proxy_username' in $info { -%>
proxy_username=<%= $info['proxy_username'] %>
<% } -%>
<% if 'proxy_password' in $info { -%>
proxy_password=<%= $info['proxy_password'] %>
<% } -%>
<% if 'exclude' in $info { -%>
<% if $info['exclude'] =~ String { -%>
exclude=<%= $info['exclude'] %>
<% } elsif $info['exclude'] =~ Array { -%>
exclude=<%= $info['exclude'].join(',') %>
<% } -%>
<% } -%>

<% } -%>
